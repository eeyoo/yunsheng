#include "tclock.h"

#include <QPixmap>
#include <QPalette>
#include <QTimer>
#include <QTime>
#include <QPainter>

TClock::TClock(QWidget *parent) :
    QWidget(parent)
{
    //QPixmap pixmap(":/Icon/Btn/Res/btn/sleep.png");
    QPixmap pixmap(":/Res/image/tclock.png");
    QPalette palette;
    palette.setBrush(backgroundRole(),QBrush(pixmap.scaled(QSize(200,200),\
                                      Qt::IgnoreAspectRatio, Qt::SmoothTransformation)));
    setPalette(palette);
    //setMask(pixmap.mask());
    setAutoFillBackground(true);

    QTimer *timer = new QTimer(this);
    timer->start(1000);//“ª√Î÷”
    connect(timer,SIGNAL(timeout()),this,SLOT(update()));
}
void TClock::UpdateTim()
{

}
void TClock::paintEvent(QPaintEvent *event)
{

    QColor hourColor(74,77,82);
    QColor minuteColor(74, 77, 82, 191);
    QColor secondColor(255, 0,0);

    QTime time = QTime::currentTime();

    QPainter painter(this);
    painter.setRenderHint(QPainter::Antialiasing);

    QPen penH(hourColor);
    penH.setWidth(2);
    QPen penM(minuteColor);
    penM.setWidth(2);
    QPen penS(secondColor);
    penS.setWidth(2);

    double dHXS = 120.0, dHYS = 100.0, dEXS = 180.0, dEYS = 100.0;
    int angleS = time.second()*6;
    painter.setPen(penS);
    painter.drawLine(RotatePT(QPointF(dHXS,dHYS),360 + 270 - angleS),
                     RotatePT(QPointF(dEXS,dEYS),450 - angleS));

    double dHXM = 115.0, dHYM = 100.0, dEXM = 170.0, dEYM = 100.0;
    int angleM = 6.0 * (time.minute() + time.second() / 60.0);
    painter.setPen(penM);
    painter.drawLine(RotatePT(QPointF(dHXM,dHYM),360 + 270 - angleM),
                     RotatePT(QPointF(dEXM,dEYM),450 - angleM));

    double dHXH = 110.0, dHYH = 100.0, dEXH = 160.0, dEYH = 100.0;
    int angleH = 30.0 * (time.hour() % 12 + time.minute() / 60.0);
    painter.setPen(penH);
    painter.drawLine(RotatePT(QPointF(dHXH,dHYH),360 + 270 - angleH),
                     RotatePT(QPointF(dEXH,dEYH),450 - angleH));
}
QPointF TClock::RotatePT(QPointF pt, int angle)
{
    double cos[] = {
        1,0.999848,0.999391,0.99863,0.997564,0.996195,0.994522,0.992547,0.990269,0.987689,0.984809,
        0.981628,0.978149,0.974372,0.970297,0.965928,0.961264,0.956307,0.951059,0.945522,0.939696,
        0.933584,0.927188,0.920509,0.91355,0.906313,0.8988,0.891013,0.882954,0.874627,0.866033,
        0.857176,0.848057,0.83868,0.829047,0.819162,0.809028,0.798647,0.788023,0.777159,0.766058,
        0.754723,0.743159,0.731369,0.719356,0.707123,0.694675,0.682016,0.669149,0.656078,0.642807,
        0.629341,0.615683,0.601837,0.587808,0.5736,0.559217,0.544664,0.529945,0.515064,0.500027,
        0.484837,0.4695,0.454019,0.438401,0.422649,0.406768,0.390763,0.374639,0.358401,0.342054,
        0.325603,0.309052,0.292408,0.275674,0.258856,0.24196,0.22499,0.207951,0.190849,0.173689,
        0.156476,0.139215,0.121912,0.104571,0.0871993,0.0698006,0.0523807,0.0349448,0.0174982,4.63268e-05,
        -0.0174056,-0.0348522,-0.0522882,-0.0697082,-0.087107,-0.104479,-0.12182,-0.139123,-0.156384,-0.173597,
        -0.190758,-0.20786,-0.224899,-0.24187,-0.258767,-0.275585,-0.292319,-0.308964,-0.325515,-0.341967,
        -0.358315,-0.374553,-0.390678,-0.406683,-0.422565,-0.438317,-0.453937,-0.469418,-0.484756,-0.499947,
        -0.514985,-0.529866,-0.544586,-0.55914,-0.573524,-0.587733,-0.601763,-0.61561,-0.629269,-0.642736,
        -0.656008,-0.66908,-0.681948,-0.694609,-0.707058,-0.719291,-0.731306,-0.743097,-0.754663,-0.765998,
        -0.7771,-0.787966,-0.798591,-0.808973,-0.819109,-0.828996,-0.838629,-0.848008,-0.857128,-0.865987,
        -0.874582,-0.882911,-0.890971,-0.898759,-0.906274,-0.913513,-0.920473,-0.927153,-0.933551,-0.939664,
        -0.945492,-0.951031,-0.95628,-0.961238,-0.965904,-0.970275,-0.974351,-0.97813,-0.981611,-0.984793,
        -0.987675,-0.990256,-0.992535,-0.994513,-0.996187,-0.997558,-0.998625,-0.999388,-0.999846,-1,
        -0.999849,-0.999394,-0.998634,-0.997571,-0.996203,-0.994532,-0.992558,-0.990282,-0.987704,-0.984825,
        -0.981646,-0.978168,-0.974392,-0.97032,-0.965952,-0.961289,-0.956334,-0.951088,-0.945552,-0.939728,
        -0.933617,-0.927223,-0.920546,-0.913588,-0.906352,-0.898841,-0.891055,-0.882998,-0.874672,-0.866079,
        -0.857223,-0.848106,-0.83873,-0.829099,-0.819216,-0.809082,-0.798703,-0.78808,-0.777217,-0.766117,
        -0.754784,-0.743221,-0.731432,-0.71942,-0.707189,-0.694742,-0.682084,-0.669218,-0.656148,-0.642878,
        -0.629413,-0.615756,-0.601911,-0.587883,-0.573676,-0.559294,-0.544741,-0.530023,-0.515144,-0.500107,
        -0.484918,-0.469582,-0.454102,-0.438484,-0.422733,-0.406852,-0.390848,-0.374725,-0.358488,-0.342141,
        -0.32569,-0.30914,-0.292496,-0.275763,-0.258946,-0.24205,-0.22508,-0.208042,-0.19094,-0.17378,
        -0.156567,-0.139307,-0.122004,-0.104664,-0.0872916,-0.0698931,-0.0524732,-0.0350374,-0.0175909,-0.00013898,
        0.0173129,0.0347596,0.0521956,0.0696158,0.0870147,0.104387,0.121728,0.139031,0.156293,0.173506,
        0.190667,0.20777,0.224809,0.24178,0.258677,0.275496,0.29223,0.308876,0.325427,0.34188,
        0.358228,0.374467,0.390592,0.406598,0.422481,0.438234,0.453854,0.469336,0.484675,0.499866,
        0.514905,0.529787,0.544508,0.559063,0.573448,0.587658,0.601689,0.615537,0.629197,0.642665,
        0.655938,0.669011,0.681881,0.694542,0.706992,0.719227,0.731242,0.743035,0.754602,0.765939,
        0.777042,0.787909,0.798535,0.808919,0.819056,0.828944,0.838579,0.847959,0.85708,0.86594,
        0.874537,0.882867,0.890929,0.898719,0.906235,0.913475,0.920437,0.927119,0.933518,0.939633,
        0.945461,0.951002,0.956253,0.961213,0.96588,0.970253,0.97433,0.97811,0.981593,0.984776,
        0.98766,0.990243,0.992524,0.994503,0.996179,0.997551,0.99862,0.999384,0.999844
    };
    double sin[] = {
        0,0.0174519,0.0348985,0.0523344,0.0697544,0.0871532,0.104525,0.121866,0.139169,0.15643,0.173643,
        0.190803,0.207906,0.224945,0.241915,0.258812,0.275629,0.292363,0.309008,0.325559,0.34201,
        0.358358,0.374596,0.39072,0.406725,0.422607,0.438359,0.453978,0.469459,0.484797,0.499987,
        0.515024,0.529905,0.544625,0.559178,0.573562,0.58777,0.6018,0.615646,0.629305,0.642772,
        0.656043,0.669115,0.681982,0.694642,0.70709,0.719323,0.731337,0.743128,0.754693,0.766028,
        0.777129,0.787994,0.798619,0.809001,0.819136,0.829021,0.838655,0.848032,0.857152,0.86601,
        0.874604,0.882933,0.890992,0.89878,0.906294,0.913532,0.920491,0.927171,0.933568,0.93968,
        0.945507,0.951045,0.956294,0.961251,0.965916,0.970286,0.974361,0.978139,0.981619,0.984801,
        0.987682,0.990262,0.992541,0.994517,0.996191,0.997561,0.998627,0.999389,0.999847,1,
        0.999849,0.999392,0.998632,0.997567,0.996199,0.994527,0.992552,0.990275,0.987696,0.984817,
        0.981637,0.978159,0.974382,0.970309,0.96594,0.961277,0.956321,0.951074,0.945537,0.939712,
        0.933601,0.927205,0.920528,0.913569,0.906333,0.89882,0.891034,0.882976,0.874649,0.866056,
        0.857199,0.848081,0.838705,0.829073,0.819189,0.809055,0.798675,0.788051,0.777188,0.766087,
        0.754754,0.74319,0.7314,0.719388,0.707156,0.694709,0.68205,0.669183,0.656113,0.642843,
        0.629377,0.615719,0.601874,0.587845,0.573638,0.559255,0.544702,0.529984,0.515104,0.500067,
        0.484878,0.469541,0.454061,0.438442,0.422691,0.40681,0.390806,0.374682,0.358444,0.342098,
        0.325647,0.309096,0.292452,0.275719,0.258901,0.242005,0.225035,0.207996,0.190894,0.173734,
        0.156521,0.139261,0.121958,0.104618,0.0872455,0.0698468,0.0524269,0.0349911,0.0175445,9.26536e-05,
        -0.0173593,-0.0348059,-0.0522419,-0.069662,-0.0870609,-0.104433,-0.121774,-0.139077,-0.156338,-0.173552,
        -0.190712,-0.207815,-0.224854,-0.241825,-0.258722,-0.27554,-0.292275,-0.30892,-0.325471,-0.341923,
        -0.358271,-0.37451,-0.390635,-0.406641,-0.422523,-0.438276,-0.453896,-0.469377,-0.484716,-0.499906,
        -0.514945,-0.529827,-0.544547,-0.559102,-0.573486,-0.587695,-0.601726,-0.615573,-0.629233,-0.642701,
        -0.655973,-0.669046,-0.681914,-0.694575,-0.707025,-0.719259,-0.731274,-0.743066,-0.754632,-0.765968,
        -0.777071,-0.787937,-0.798563,-0.808946,-0.819083,-0.82897,-0.838604,-0.847983,-0.857104,-0.865964,
        -0.87456,-0.882889,-0.89095,-0.898739,-0.906254,-0.913494,-0.920455,-0.927136,-0.933534,-0.939649,
        -0.945477,-0.951016,-0.956267,-0.961226,-0.965892,-0.970264,-0.97434,-0.97812,-0.981602,-0.984785,
        -0.987667,-0.990249,-0.99253,-0.994508,-0.996183,-0.997554,-0.998622,-0.999386,-0.999845,-1,
        -0.99985,-0.999396,-0.998637,-0.997574,-0.996207,-0.994537,-0.992564,-0.990288,-0.987711,-0.984833,
        -0.981655,-0.978178,-0.974403,-0.970331,-0.965964,-0.961302,-0.956348,-0.951102,-0.945567,-0.939744,
        -0.933634,-0.92724,-0.920564,-0.913607,-0.906372,-0.898861,-0.891076,-0.88302,-0.874694,-0.866103,
        -0.857247,-0.84813,-0.838756,-0.829125,-0.819242,-0.80911,-0.798731,-0.788108,-0.777246,-0.766147,
        -0.754815,-0.743252,-0.731464,-0.719452,-0.707221,-0.694775,-0.682118,-0.669252,-0.656183,-0.642914,
        -0.629449,-0.615792,-0.601948,-0.58792,-0.573713,-0.559332,-0.54478,-0.530062,-0.515183,-0.500147,
        -0.484959,-0.469622,-0.454143,-0.438526,-0.422775,-0.406895,-0.390891,-0.374768,-0.358531,-0.342185,
        -0.325734,-0.309184,-0.292541,-0.275808,-0.258991,-0.242095,-0.225125,-0.208087,-0.190985,-0.173826,
        -0.156613,-0.139353,-0.12205,-0.10471,-0.0873378,-0.0699393,-0.0525195,-0.0350837,-0.0176372
    };

    angle %= 360;
    pt -= QPointF(100,100);
    return QPointF(pt.x()*cos[angle]+pt.y()*sin[angle]+100,
                   -pt.x()*sin[angle]+pt.y()*cos[angle]+100);
}
